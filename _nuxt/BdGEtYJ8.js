import{g as T,r as c,k,s as $,z as O,e as I,w as x,o as m,a as n,b,c as j,p as S,t as L,F as X,h as Y,n as Z,d as ee,y as Q,q,_ as se,u as te}from"./CEJX9E6Q.js";import{_ as ae}from"./CgQ5lQtw.js";import{D as le}from"./DCqxpuge.js";import{F}from"./CIo5sv1j.js";import{D as ie,a as oe,E as ne}from"./DXIw8x5b.js";import{B as re}from"./CFdCBK2j.js";import{B as ue}from"./CyEs641m.js";import"./DgMA-dYW.js";import"./DTDnaLW0.js";import"./Dk0J2JMS.js";import"./vCy60rdo.js";/* empty css        *//* empty css        */const de={key:0,class:"emoji-box"},ce=["src","alt"],me=["innerHTML"],ge={key:1,class:"emoji-box"},ve=["src","alt"],pe={key:2,class:"image-preview-section"},be={class:"image-preview-container"},fe=["src","alt"],ye=["onClick"],je=T({__name:"DiaryEditor",props:{isEditMode:{type:Boolean,default:!1},diaryId:{type:String,default:""},initialData:{type:Object,default:()=>({})}},emits:["save","close"],setup(_,{emit:f}){Q();const E=q(),s=_,D=f,u=c(new Date),i=c(null),y=c(""),g=c(!1),o=c(""),l=c(!1),d=c(!1),r=c([]),w=[{src:"/assets/images/emoji/happy.svg",label:"행복"},{src:"/assets/images/emoji/peaceful.svg",label:"평온"},{src:"/assets/images/emoji/excited.svg",label:"설렘"},{src:"/assets/images/emoji/sad.svg",label:"슬픔"},{src:"/assets/images/emoji/angry.svg",label:"화남"},{src:"/assets/images/emoji/upset.svg",label:"속상"},{src:"/assets/images/emoji/indifferent.svg",label:"덤덤"},{src:"/assets/images/emoji/fun.svg",label:"재미"},{src:"/assets/images/emoji/surprise.svg",label:"놀람"},{src:"/assets/images/emoji/worry.svg",label:"걱정"},{src:"/assets/images/emoji/hurt.svg",label:"아파"},{src:"/assets/images/emoji/embarrassed.svg",label:"창피"},{src:"/assets/images/emoji/flustered.svg",label:"당황"},{src:"/assets/images/emoji/frustrated.svg",label:"답답"},{src:"/assets/images/emoji/annoyed.svg",label:"짜증"},{src:"/assets/images/emoji/ruined.svg",label:"망함"},{src:"/assets/images/emoji/shocked.svg",label:"헐"},{src:"/assets/images/emoji/thrilled.svg",label:"신남"},{src:"/assets/images/emoji/cheer.svg",label:"응원"},{src:"/assets/images/emoji/congrats.svg",label:"축하"},{src:"/assets/images/emoji/touched.svg",label:"감동"}],R=k(()=>s.isEditMode?"마음일기 수정하기":"마음일기"),U=k(()=>!s.isEditMode),J=k(()=>s.isEditMode),P=k(()=>s.isEditMode?`/community/diary/${s.diaryId}/edit`:"/community/diary/create");k(()=>!g.value);const z=t=>t?t.replace(/<br\s*\/?>/gi," "):"",M=()=>{s.initialData&&Object.keys(s.initialData).length>0&&(u.value=new Date(s.initialData.date||new Date),i.value=s.initialData.emoji||null,y.value=s.initialData.content||"",r.value=s.initialData.images||[],g.value=s.initialData.isDailyQuote||!1,o.value=s.initialData.dailyQuoteQuestion||"")},H=t=>{u.value=new Date(t),console.log("날짜 변경:",u.value.toISOString().split("T")[0])},A=t=>{console.log("이모지 선택됨:",t),l.value=!1},B=()=>{if(r.value.length>3){C("사진은 최대 3장만 가능합니다.");return}const t={id:s.isEditMode?Number(s.diaryId):void 0,date:u.value.toISOString().split("T")[0],emoji:i.value,content:y.value.trim(),images:r.value,isDailyQuote:g.value,dailyQuoteQuestion:g.value?o.value:void 0,createdAt:new Date().toISOString()};D("save",t)},G=()=>{if(r.value.length>=3){C("사진은 최대 3장만 가능합니다.");return}B()},K=()=>{D("close")},C=t=>{alert(t)},W=t=>{r.value.splice(t,1)};return $(()=>{s.initialData&&Object.keys(s.initialData).length>0&&M()}),O(()=>s.initialData,t=>{t&&Object.keys(t).length>0&&M()},{immediate:!1,deep:!0}),O(()=>E.query,t=>{if(console.log("받은 쿼리:",t),t.emoji&&t.name){const e=t.emoji,a=t.name;console.log("찾을 이모지:",{emojiFile:e,emojiName:a});const v=w.find(p=>{var N;const h=(N=p.src.split("/").pop())==null?void 0:N.replace(".svg",""),V=h===e||p.label===a;return console.log("매칭 확인:",{fileName:h,emojiLabel:p.label,matches:V}),V});v?(i.value=v,console.log("이모지 업데이트:",v)):(console.log("이모지를 찾을 수 없음:",{emojiFile:e,emojiName:a}),console.log("사용 가능한 이모지:",w.map(p=>{var h;return{file:(h=p.src.split("/").pop())==null?void 0:h.replace(".svg",""),label:p.label}})))}},{immediate:!1,deep:!0}),(t,e)=>(m(),I(ae,{"page-title":R.value,"show-back-button":U.value,"has-close-btn":J.value,"add-text-click-enabled":!1,onClose:K},{default:x(()=>[n("section",null,[b(F,null,{default:x(()=>[b(le,{modelValue:u.value,"onUpdate:modelValue":[e[0]||(e[0]=a=>u.value=a),H],class:"mt-23 mb-10","navigation-mode":"notyear","prev-btn":!1,"next-btn":!1},null,8,["modelValue"]),g.value?S("",!0):(m(),j("button",{key:0,onClick:e[1]||(e[1]=a=>l.value=!0),class:"chage-btn"},e[8]||(e[8]=[n("span",null,"기분 바꾸기",-1),n("i",{class:"icon arrow-down-type"},null,-1)])))]),_:1}),b(F,{class:"pb-24"},{default:x(()=>[g.value&&i.value?(m(),j("div",de,[e[9]||(e[9]=n("p",{class:"daily-quote-label"},"오늘 한마디",-1)),n("img",{src:i.value.src,alt:i.value.label},null,8,ce),n("p",{class:"daily-quote-question",innerHTML:z(o.value)},null,8,me)])):i.value?(m(),j("div",ge,[n("img",{src:i.value.src,alt:i.value.label},null,8,ve),n("p",null,"오늘 마음은 "+L(i.value.label)+"!",1)])):S("",!0),b(ie,{modelValue:y.value,"onUpdate:modelValue":e[2]||(e[2]=a=>y.value=a),class:"diary-fieldset",onFocus:e[3]||(e[3]=a=>d.value=!0),onBlur:e[4]||(e[4]=a=>d.value=!1)},null,8,["modelValue"]),r.value.length>0?(m(),j("div",pe,[n("div",be,[(m(!0),j(X,null,Y(r.value,(a,v)=>(m(),j("div",{key:v,class:"image-preview-item"},[n("img",{src:a,alt:`미리보기 이미지 ${v+1}`},null,8,fe),n("button",{type:"button",class:"remove-image-btn",onClick:p=>W(v),"aria-label":"이미지 제거"},e[10]||(e[10]=[n("i",{class:"icon ico-close"},null,-1)]),8,ye)]))),128))])])):S("",!0),b(oe,{modelValue:r.value,"onUpdate:modelValue":e[5]||(e[5]=a=>r.value=a),class:Z(["diary-image-uploader-fixed",{"is-focused":d.value}]),"register-button-text":d.value?"완료":"",onImageLimitExceeded:e[6]||(e[6]=()=>C("사진은 최대 3장만 가능합니다.")),onRegister:G},null,8,["modelValue","class","register-button-text"]),d.value?S("",!0):(m(),I(ue,{key:3,class:"is-fixed"},{default:x(()=>[b(re,{"btn-type":"primary","element-type":"button",class:"lg w-full medium btn-sticky",onClick:B},{default:x(()=>[ee(L(_.isEditMode?"수정하기":"등록하기"),1)]),_:1})]),_:1}))]),_:1})]),b(ne,{"is-visible":l.value,"return-path":P.value,"selected-date":u.value.toISOString().split("T")[0],onClose:e[7]||(e[7]=a=>l.value=!1),onEmojiSelected:A},null,8,["is-visible","return-path","selected-date"])]),_:1},8,["page-title","show-back-button","has-close-btn"]))}}),De=se(je,[["__scopeId","data-v-571833ba"]]),Oe=T({__name:"edit",setup(_){const f=Q(),s=q().params.diaryId,D=c({}),u=c(!1),i=()=>{try{const l=JSON.parse(localStorage.getItem("diaryList")||"[]").find(d=>d.id===Number(s));l?(D.value=l,u.value=!0,console.log("기존 다이어리 로드:",l)):(console.error("다이어리를 찾을 수 없음:",s),f.push("/community/diary/list"))}catch(o){console.error("다이어리 로드 실패:",o),f.push("/community/diary/list")}},y=o=>{console.log("수정할 다이어리 데이터:",o);const l=JSON.parse(localStorage.getItem("diaryList")||"[]"),d=l.findIndex(r=>r.id===Number(s));if(d!==-1)l[d]=o;else{console.error("수정할 다이어리를 찾을 수 없음");return}localStorage.setItem("diaryList",JSON.stringify(l)),console.log("다이어리 수정 완료:",o),f.push({path:"/community/diary/list",query:{scrollTo:o.date,updatedDiary:"true"}})},g=()=>{f.go(-1)};return $(()=>{i()}),(o,l)=>u.value?(m(),I(De,{key:0,"is-edit-mode":!0,"diary-id":te(s),"initial-data":D.value,onSave:y,onClose:g},null,8,["diary-id","initial-data"])):S("",!0)}});export{Oe as default};
