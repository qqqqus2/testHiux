import{g as oe,r as l,q as le,z as ae,s as ie,Z as ne,e as U,w as y,y as re,o as d,a as n,b as r,p as w,c as p,t as B,F as ue,h as ce,n as de,d as z,_ as me}from"./DXf4teaX.js";import{_ as ve}from"./POueqNYg.js";import{D as A}from"./BiCQc8sh.js";import{F as P}from"./DTCFSvLB.js";import{D as ge,a as fe,E as pe}from"./Bcr--kV9.js";import{C as be}from"./xIpul_or.js";import{B as ye}from"./gQhdBu5f.js";import{_ as we}from"./BIybNI5N.js";import{B as he}from"./Bvlp-8xv.js";import{B as xe}from"./CfZVyjAv.js";import"./BuTUJ7n4.js";/* empty css        *//* empty css        */import"./DHMPA8pk.js";import"./BtumP7DE.js";import"./DTQMWgQb.js";/* empty css        *//* empty css        */const je={class:"date-label"},De={key:0,class:"daily-quote-title"},_e=["innerHTML"],ke={key:1,class:"emoji-box"},Ce=["src","alt"],Ve={key:1},Ee={key:0,class:"image-preview-section"},Se={class:"image-preview-container"},Fe=["src","alt"],Me=["onClick"],qe=oe({__name:"create",setup(Ie){const J=re(),u=le(),m=l(new Date(u.query.date||new Date)),i=l(null),_=l(""),v=l([]),T=l(null),C=l(!1),k=l(!1),V=l(null),b=l(!1),M=l(""),h=l(!1),E=l(!1),$=l(""),L=l(!1),x=l(0),f=l(!1),S=[{src:"/_nuxt/assets/images/emoji/happy.svg",label:"행복"},{src:"/_nuxt/assets/images/emoji/peaceful.svg",label:"평온"},{src:"/_nuxt/assets/images/emoji/excited.svg",label:"설렘"},{src:"/_nuxt/assets/images/emoji/sad.svg",label:"슬픔"},{src:"/_nuxt/assets/images/emoji/angry.svg",label:"화남"},{src:"/_nuxt/assets/images/emoji/upset.svg",label:"속상"},{src:"/_nuxt/assets/images/emoji/indifferent.svg",label:"덤덤"},{src:"/_nuxt/assets/images/emoji/fun.svg",label:"재미"},{src:"/_nuxt/assets/images/emoji/surprise.svg",label:"놀람"},{src:"/_nuxt/assets/images/emoji/worry.svg",label:"걱정"},{src:"/_nuxt/assets/images/emoji/hurt.svg",label:"아파"},{src:"/_nuxt/assets/images/emoji/embarrassed.svg",label:"창피"},{src:"/_nuxt/assets/images/emoji/flustered.svg",label:"당황"},{src:"/_nuxt/assets/images/emoji/frustrated.svg",label:"답답"},{src:"/_nuxt/assets/images/emoji/annoyed.svg",label:"짜증"},{src:"/_nuxt/assets/images/emoji/ruined.svg",label:"망함"},{src:"/_nuxt/assets/images/emoji/shocked.svg",label:"헐"},{src:"/_nuxt/assets/images/emoji/thrilled.svg",label:"신남"},{src:"/_nuxt/assets/images/emoji/cheer.svg",label:"응원"},{src:"/_nuxt/assets/images/emoji/congrats.svg",label:"축하"},{src:"/_nuxt/assets/images/emoji/touched.svg",label:"감동"}],R=()=>{if(u.query.edit==="true"&&u.query.id){k.value=!0,V.value=Number(u.query.id);const e=JSON.parse(localStorage.getItem("diaryList")||"[]").find(s=>s.id===V.value);e&&(m.value=new Date(e.date),i.value=e.emoji,_.value=e.content,v.value=e.images||[])}};ae(()=>u.query,(t,e)=>{if(console.log("받은 쿼리:",t),console.log("이전 쿼리:",e),t.type==="daily-quote"){if(b.value=!0,M.value=t.question,t.emoji){const s=t.emoji;console.log("daily-quote 모드에서 찾을 이모지:",s);const o=S.find(c=>{const a=c.src.split("/").pop(),g=a==null?void 0:a.replace(".svg",""),D=s.replace(".svg","");return console.log("비교:",{fileNameWithoutExt:g,emojiFileWithoutExt:D,matches:g===D}),g===D});o?(i.value=o,console.log("daily-quote 모드에서 이모지 설정 완료:",o)):(console.log("daily-quote 모드에서 이모지를 찾을 수 없음:",s),console.log("사용 가능한 이모지:",S.map(c=>{var a;return(a=c.src.split("/").pop())==null?void 0:a.replace(".svg","")})))}return}if(b.value=!1,t.emoji&&t.name){const s=t.emoji,o=t.name;console.log("찾을 이모지:",{emojiFile:s,emojiName:o});const c=S.find(a=>{var O;const g=(O=a.src.split("/").pop())==null?void 0:O.replace(".svg",""),D=s.replace(".svg",""),N=g===D||a.label===o;return console.log("매칭 확인:",{fileName:g,emojiFileWithoutExt:D,emojiLabel:a.label,matches:N}),N});c?(e&&(e.emoji!==t.emoji||e.name!==t.name)&&(console.log("이모지 변경 감지: 기존 내용과 이미지 보존"),console.log("기존 내용:",_.value),console.log("기존 이미지 개수:",v.value.length)),i.value=c,console.log("이모지 업데이트:",c)):(console.log("이모지를 찾을 수 없음:",{emojiFile:s,emojiName:o}),console.log("사용 가능한 이모지:",S.map(a=>{var g;return{file:(g=a.src.split("/").pop())==null?void 0:g.replace(".svg",""),label:a.label}})))}},{immediate:!0,deep:!0});const q=t=>{m.value=t,F.value=!1},I=()=>{console.log("=== showSaveConfirm 호출됨 ==="),console.log("현재 showConfirmModal.value:",h.value),h.value=!0,console.log("변경 후 showConfirmModal.value:",h.value),console.log("=== showSaveConfirm 완료 ===")},W=()=>{if(v.value.length>3){j("사진은 최대 3장만 가능합니다.");return}const t={id:k.value?V.value:Date.now(),date:m.value.toISOString().split("T")[0],emoji:i.value,content:_.value.trim(),images:v.value,isDailyQuote:b.value,dailyQuoteQuestion:b.value?M.value:void 0,createdAt:k.value?new Date().toISOString():new Date().toISOString()};console.log("저장할 다이어리 데이터:",t);let e=[];try{const s=localStorage.getItem("diaryList");e=s?JSON.parse(s):[]}catch(s){console.error("localStorage에서 데이터를 가져오는 중 오류:",s),e=[]}if(k.value){const s=e.findIndex(o=>o.id===V.value);s!==-1&&(e[s]=t)}else e.push(t);try{const s=JSON.stringify(e),o=new Blob([s]).size/(1024*1024);o>4&&(console.warn(`localStorage 데이터 크기가 ${o.toFixed(2)}MB입니다. 용량 제한에 근접했습니다.`),j("저장 공간이 부족할 수 있습니다. 일부 이미지를 제거해주세요.")),localStorage.setItem("diaryList",s),console.log("다이어리 저장 완료:",t)}catch(s){console.error("localStorage에 저장하는 중 오류:",s),s instanceof Error&&s.name==="QuotaExceededError"?j("저장 공간이 부족합니다. 일부 이미지를 제거하고 다시 시도해주세요."):j("저장 중 오류가 발생했습니다.");return}j("일기가 기록되었습니다."),J.push("/community/diary/list")},j=t=>{$.value=t,E.value=!0,setTimeout(()=>{E.value=!1},3e3)},K=t=>{v.value.splice(t,1),T.value&&(T.value.value="")},G=t=>{console.log("이모지 선택됨:",t),C.value=!1},Z=()=>{console.log("🎯 DiaryFieldset 포커스됨 - 가상 키패드가 열릴 수 있음"),console.log("📱 포커스 상태 변경:",f.value,"→",!0),f.value=!0},X=()=>{console.log("🔚 DiaryFieldset 블러됨 - 가상 키패드가 닫힐 수 있음"),console.log("📱 포커스 상태 변경:",f.value,"→",!1),f.value=!1},Y=()=>{console.log("완료 버튼 클릭됨 - 포커스 아웃 처리"),f.value=!1,typeof document<"u"&&document.activeElement instanceof HTMLElement&&document.activeElement.blur()},H=ne("setAddTextClickHandler"),Q=()=>{if(typeof window<"u"&&"visualViewport"in window){const t=window.visualViewport;x.value===0&&(x.value=t.height);const e=x.value-t.height,s=x.value*.2;L.value=e>s,console.log("가상 키패드 상태:",{isOpen:L.value,initialHeight:x.value,currentHeight:t.height,difference:e,threshold:s})}};ie(()=>{if(!u.query.type&&!u.query.emoji&&!u.query.name&&!i.value&&(i.value={src:"/_nuxt/assets/images/emoji/happy.svg",label:"행복"}),u.query.edit==="true"&&u.query.id&&R(),H?(console.log("setAddTextClickHandler 설정:",I),H(I)):console.error("setAddTextClickHandler가 없습니다!"),typeof window<"u"&&"visualViewport"in window){const t=window.visualViewport;t.addEventListener("resize",Q),x.value=t.height}});const ee=t=>{const e=t.getMonth()+1,s=t.getDate(),c=["일","월","화","수","목","금","토"][t.getDay()];return`${e}월 ${s}일 ${c}요일`},se=()=>{const t=new Date,e=[];for(let s=0;s<365;s++){const o=new Date(t);o.setDate(t.getDate()+s+1),e.push(o)}return e},F=l(!1),te=()=>{F.value=!0};return(t,e)=>(d(),U(ve,{"page-title":k.value?"마음일기 수정하기":"마음일기 등록하기 ","show-back-button":!0},{default:y(()=>[n("section",null,[r(P,null,{default:y(()=>[n("div",{class:"date-display mt-20 mb-24",onClick:te},[r(A,{modelValue:m.value,"onUpdate:modelValue":[e[0]||(e[0]=s=>m.value=s),q],"show-header":!1,"show-navigation":!1,"show-calendar":!0,"show-time-picker":!1,class:"date-picker-display"},null,8,["modelValue"]),n("span",je,B(ee(m.value)),1)]),b.value?(d(),p("div",De,[e[12]||(e[12]=n("span",null,"오늘 한마디",-1)),n("p",{innerHTML:M.value},null,8,_e)])):w("",!0),i.value||b.value?(d(),p("div",ke,[i.value?(d(),p("img",{key:0,src:i.value.src,alt:i.value.label},null,8,Ce)):w("",!0),i.value?(d(),p("p",Ve,"오늘 마음은 "+B(i.value.label)+"!",1)):w("",!0),b.value?w("",!0):(d(),p("button",{key:2,onClick:e[1]||(e[1]=s=>C.value=!0),class:"chage-btn"},e[13]||(e[13]=[n("span",null,"기분 바꾸기",-1),n("i",{class:"icon arrow-down-type"},null,-1)])))])):w("",!0)]),_:1}),r(P,{class:"pb-24"},{default:y(()=>[r(ge,{modelValue:_.value,"onUpdate:modelValue":e[2]||(e[2]=s=>_.value=s),onFocus:Z,onBlur:X},null,8,["modelValue"]),v.value.length>0?(d(),p("div",Ee,[n("div",Se,[(d(!0),p(ue,null,ce(v.value,(s,o)=>(d(),p("div",{key:o,class:"image-preview-item"},[n("img",{src:s,alt:`미리보기 이미지 ${o+1}`},null,8,Fe),n("button",{type:"button",class:"remove-image-btn",onClick:c=>K(o),"aria-label":"이미지 제거"},e[14]||(e[14]=[n("i",{class:"icon ico-close"},null,-1)]),8,Me)]))),128))])])):w("",!0)]),_:1}),r(fe,{modelValue:v.value,"onUpdate:modelValue":e[3]||(e[3]=s=>v.value=s),class:de(["diary-image-uploader-fixed",{"is-focused":f.value}]),"register-button-text":f.value?"완료":"",onImageLimitExceeded:e[4]||(e[4]=()=>j("사진은 최대 3장만 가능합니다.")),onRegister:Y},null,8,["modelValue","class","register-button-text"]),f.value?w("",!0):(d(),U(xe,{key:0,class:"is-fixed"},{default:y(()=>[r(he,{"btn-type":"primary","element-type":"button",class:"lg w-full medium btn-sticky",onClick:I},{default:y(()=>e[15]||(e[15]=[z(" 등록하기 ")])),_:1,__:[15]})]),_:1}))]),r(pe,{"is-visible":C.value,"return-path":"/community/diary/create",onClose:e[5]||(e[5]=s=>C.value=!1),onEmojiSelected:G},null,8,["is-visible"]),r(be,{"is-visible":h.value,title:"일기 등록",content:"일기를 등록하시겠습니까?","confirm-button-text":"등록","cancel-button-text":"취소",onConfirm:W,onCancel:e[6]||(e[6]=s=>h.value=!1),onClose:e[7]||(e[7]=s=>h.value=!1),class:"modal-confirm-modal"},null,8,["is-visible"]),r(ye,{modelValue:E.value,"onUpdate:modelValue":e[8]||(e[8]=s=>E.value=s),type:"success"},{default:y(()=>[z(B($.value),1)]),_:1},8,["modelValue"]),r(we,{"is-visible":F.value,title:"날짜 선택",onClose:e[10]||(e[10]=s=>F.value=!1),onConfirm:e[11]||(e[11]=s=>q(m.value)),"is-show-confirm-button":!1,"is-show-cancel-button":!1},{content:y(()=>[r(A,{modelValue:m.value,"onUpdate:modelValue":[e[9]||(e[9]=s=>m.value=s),q],"show-header":!0,"show-navigation":!0,"show-calendar":!0,"show-time-picker":!1,"disabled-dates":se()},null,8,["modelValue","disabled-dates"])]),_:1},8,["is-visible"])]),_:1},8,["page-title"]))}}),Ye=me(qe,[["__scopeId","data-v-8e5e7d90"]]);export{Ye as default};
